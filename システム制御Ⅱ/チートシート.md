# システム制御Ⅱ


## 中間編

## 微分方程式から状態方程式の求め方

一番高い階数の微分以外に状態量を割り当てるだけ。形は
$$
\begin{aligned} 
&\bold{X'(t)}=A\bold{X(t)}+Bu(t) \cr
&Y(t)=CX(t)+Du(t)
\end{aligned}
$$
なお、$Du(t)$は直立項と呼ばれる。出力に入力が定数倍されてそのまま出る部分。

例えばRLC直列回路の場合
$$
e(t)=Ri(t )+Li(t)'+\frac{1}{c}\int_{0}^{t}i(t)dt
$$
となるが、変形して
$$
\frac{1}{L}e(t)=\frac{R}{L}i(t )+i(t)'+\frac{1}{cL}\int_{0}^{t}i(t)dt
$$
入力を$e(t)$、出力を$y(t)=\int_{0}^{t}i(t)dt$だとおもうと
$$
\frac{1}{L}e(t)=y''+\frac{R}{L}y'+\frac{1}{cL}y
$$
となる。ここで一番高い階数の微分以外に状態量を割り当ててる。つまり
$$
x_1=y、x_2=y'、X=
\begin{pmatrix}
x_1 \cr
x_2
\end{pmatrix}
$$
とおくと、
$$
X'=\begin{pmatrix}
1 & 0 \cr
-\frac{1}{cL} & -\frac{R}{L}
\end{pmatrix}X+\begin{pmatrix}
0 \cr
\frac{1}{L}
\end{pmatrix}u(t)
$$
となる。

## $e^{At}$の求め方(対角化で)

公式は
$$e^{At}=Te^{Bt}T^{-1}$$
なお、
$$T^{-1}AT=B$$
である。証明は
$$
\begin{aligned} 
e^{At}&=I+At+\frac{A^2}{2!}t^2+\frac{A^3}{3!}t^3+\cdots \cr
&=TT^{-1}+TBT^{-1}t+\frac{TB^2T^{-1}}{2!}t^2+\frac{TB^3T^{-1}}{3!}t^3+\cdots \cr
&=T(I+Bt+\frac{B^2}{2!}t^2+\frac{B^3}{3!}t^3+\cdots)T^{-1} \cr
&=Te^{Bt}T^{-1}
\end{aligned}
$$

ただしBは例えば$B= \begin{pmatrix} 1 & 0 \cr 0 & -2 \end{pmatrix}$のような対角行列なので$e^{Bt}$は簡単に
$$e^{Bt}=
\begin{pmatrix}
e^{t} & 0 \cr
0 & e^{-2t}
\end{pmatrix}$$
となる。

## $e^{At}$の求め方(ラプラス変換で)

公式は
$$e^{At}=\mathcal{L}^{-1}[(sI-A)^{-1}]$$
証明は$u(t)=0$とすると
$$X'=AX$$
となるのでラプラス変換して
$$sX(s)-X_0=AX(s) →(SI-A)X(s)=X_0$$
逆行列を左からかけて
$$X(s)=(SI-A)^{-1}X_0$$
よって$u(t)=0$ならば
$$X(t)=\mathcal{L}^{-1}[(sI-A)^{-1}]X_0$$
ここで$X$の一般解は
$$X(t)=e^{At}X_0+\int_{0}^{t} e^{A(t-τ)}bu(τ) dτ \underset{u(τ)=0}{\longrightarrow} X(t)=e^{At}X_0$$
なので比較して
$$e^{At}=\mathcal{L}^{-1}[(sI-A)^{-1}]$$
となる。

## 状態方程式$\bold{x}$の一般解(積分で)

公式は
$$
X=e^{At}X_0+\int_{0}^{t} e^{A(t-τ)}Bu(τ) dτ
$$
なので$e^{At}$さえわかれば頑張るだけ。なお、$\int_{0}^{t} e^{A(t-τ)}Bu(τ) dτ$を忘れたときは、
$$
\int_{0}^{t} x(t-τ)y(τ) dτ = \mathcal{L}^{-1}[XY]
$$
の関係式を思い出して
$$
\mathcal{L}^{-1}[(sI-A)^{-1}BU(s)] \underset{X=(sI-A)^{-1}、Y=BU(s)}{\longrightarrow} \int_{0}^{t} e^{A(t-τ)}Bu(τ) dτ
$$
とすれば導ける。ラプラス変換の式は次の項へ↓

## 状態方程式$\bold{x}$の一般解(ラプラス変換で)

公式は
$$
X(t)=\mathcal{L}^{-1}[(sI-A)^{-1}]X_0+\mathcal{L}^{-1}[(sI-A)^{-1}BU(s)]
$$
忘れたときは
$$
\bold{X'(t)}=A\bold{X(t)}+Bu(t)
$$
をラプラス変換して
$$
sX(s)-X_0=AX(s)+BU(s) {\longrightarrow} (sI-A)X(s)=X_0+BU(s)
$$
より$(sI-A)^{-1}$を左からかけて
$$
X(s)=(sI-A)^{-1}X_0+(sI-A)^{-1}BU(s)
$$
逆ラプラス変換して
$$
X(t)=\mathcal{L}^{-1}[(sI-A)^{-1}]X_0+\mathcal{L}^{-1}[(sI-A)^{-1}BU(s)]
$$

## 出力方程式の求め方

$$
Y(t)=CX(t)+Du(t)
$$
に代入するだけ。

## フルランク

$A$を$n×m$行列する。Aのフルランクとは
$$
rank(A)=min(n,m)
$$
のことを言う。なお、**ランクは転置しても変わらない**

もし$n=m$なら
$$
rank(A)=n \Leftrightarrow det(A) \ne 0
$$
正方行列がフルランクか調べるなら大抵$det(A) \ne 0$を使った方が早い。問題はせいぜい4×4とかの行列だから。

## 線形独立

$A$を$n×m$行列する。ここで
$$
rank(A)=k
$$
だったとする。ここで**列ベクトル**が線形独立なのかを調べるには(列は縦)
$$
k=m \Leftrightarrow \bold{列ベクトル}が線形独立
$$
を調べればいい。ランクは意味を持つ式の本数なので列数=ランクとなればすべての列ベクトルは意味を持つことになる。

逆に**行ベクトル**が線形独立なのかを調べるには(行は横)
$$
k=n \Leftrightarrow \bold{行ベクトル}が線形独立
$$
を調べればいい。ランクは意味を持つ式の本数なので行数=ランクとなればすべての行ベクトルは意味を持つことになる。



## 可制御の判定(やり方その1)

定理
$$
行列e^{At}Bの\bold{行ベクトル}が線形独立ならば可制御
$$

よって $e^{At}B$のランクを求めて**行数と一致するか調べる**。問題で既に$e^{AT}$を求めたならこっちの方が楽かな？

可制御はかせい"ぎょう"で調べる。と覚える。

## 可制御の判定(やり方その2)

状態変数の数(=Aの列数)をnとする。
$$M_C=\begin{pmatrix} 
  b & Ab & \dots  & A^{n-1}b \cr
\end{pmatrix}$$
とすると
$$ rankM_c=n$$
が成立すれば可制御。$e^{AT}$を求てないならこっちの方が楽かな？

## 可観測の判定(やり方その1)

定理
$$
行列Ce^{At}の\bold{列ベクトル}が線形独立ならば可制御
$$

よって $Ce^{At}$のランクを求めて**列数と一致するか調べる**。問題で既に$e^{AT}$を求めたならこっちの方が楽かな？

## 可観測の判定(やり方その2)

状態変数の数(=Aの列数)をnとする。
$$M_O=\begin{pmatrix} 
  C  \cr
  CA \cr
  \dots \cr
  CA^{n-1} \cr
\end{pmatrix}$$
とすると
$$ rankM_c=n$$
が成立すれば可制御。$e^{AT}$を求てないならこっちの方が楽かな？

## 期末編

## 座標変換

$$
\begin{aligned} 
&\bold{X'(t)}=A\bold{X(t)}+Bu(t) \cr
&Y(t)=CX(t)+Du(t)
\end{aligned}
$$
に対し、$\bold{X(t)=TZ(t)}$の線形変換を定義すると
$$
\begin{aligned} 
&\bold{TZ'(t)}=A\bold{TZ(t)}+Bu(t) \cr
&Y(t)=C\bold{TZ(t)}+Du(t)
\end{aligned}
$$
の左から$\bold{T^{-1}}$をかけて
$$
\begin{aligned} 
&\bold{Z'(t)}=\bold{T^{-1}ATZ(t)}+\bold{T^{-1}}Bu(t) \cr
&Y(t)=C\bold{TZ(t)}+Du(t)
\end{aligned}
$$
となる。$\bar{A}=\bold{T^{-1}AT}、\bar{B}=\bold{T^{-1}}B、\bar{C}=C\bold{T}$と置けば

$$
\begin{aligned} 
&\bold{Z'(t)}=\bar{A}\bold{Z(t)}+\bar{B}u(t) \cr
&Y(t)=\bar{C}Z(t)+Du(t)
\end{aligned}
$$

となる。なお、$\bar{A}=\bold{T^{-1}AT}$は[相似な行列](https://yukimaru77.github.io/practice/%E7%B7%9A%E5%BD%A2%E4%BB%A3%E6%95%B0(%E3%83%A1%E3%83%A2)/%E7%B7%9A%E5%BD%A2%E4%BB%A3%E6%95%B0(%E3%83%A1%E3%83%A2).html#%E7%9B%B8%E4%BC%BC%E3%81%AA%E8%A1%8C%E5%88%97)の定義そのもので固有値(=固有多項式)や行列式等の行列関係の諸量は等しくなる。固有ベクトルは$\bold{T^{-1}}$を掛けた値となる。

## 可制御正準形

座標変換のうち特に
$$
\begin{aligned} 
&\bold{Z'(t)}={{\begin{pmatrix} 
0 & 1 & 0 & \qquad &0 \cr
0 & 0 & 1 & \qquad &0 \cr
0 & 0 & 0 & \qquad &0 \cr
\vdots & & & \ddots &1 \cr
-α_0 & -α_1 & -α_2 & \cdots & -α_{n-1}
\end{pmatrix}}}\bold{Z(t)}+{\begin{pmatrix} 
0 \cr 
0 \cr
\vdots \cr
0 \cr
1
\end{pmatrix}}u(t) \cr \cr
&Y(t)={\begin{pmatrix} β_1 & β_2 &\cdots & β_n\end{pmatrix}}Z(t)+Du(t)
\end{aligned}
$$
と表せる時、この表現形式を可制御正準形という。固有方程式は$\bold{A}、\bold{\bar{A}}$について、座標変換後も相似な行列の性質より不変な事に注意すると
$$
|sI-A|=|sI-\bar{A}|=s^n+a_{n-1}s^{n-1}+\cdots +a_1s+a_0=0
$$
となり、伝達関数は
$$
G(s)=\frac{β_ns^{n-1}+β_{n-1}s^{n-2}+\cdots +β_2s+β_1}{s^n+a_{n-1}s^{n-1}+\cdots +a_1s+a_0}
$$
となる。分子の方が次数が小さいので注意。テストで出るようなシステム制御の問題は基本プロパー(分子の次数＜分母の次数)になる(気がする)。
